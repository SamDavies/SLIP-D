<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>SLIP group D - Smart Lock</title>

        <!-- tocify CSS -->
        <link type="text/css" rel="stylesheet" href="css/jquery.tocify.css" />
        
        <!-- Bootstrap Core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="css/stylish-portfolio.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
        <link rel="icon" href="favicon.ico" type="image/x-icon">
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    </head>

    <body>

        <!-- Navigation -->
        <a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
        <nav id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
                <li class="sidebar-brand">
                    <a href="#top"  onclick = $("#menu-close").click(); >Close</a>
                </li>
                <li>
                    <a href="index.html">Home</a>
                </li>
                <li>
                    <a href="ayrton.html">Ayrton Massey</a>
                </li>
                <li>
                    <a href="dan.html">Dan Ristea</a>
                </li>
                <li>
                    <a href="fabien.html">Fabien Florek</a>
                </li>
                <li>
                    <a href="jp.html">JP Larsson</a>
                </li>
                <li>
                    <a href="michael.html">Michael Inglis</a>
                </li>
                <li>
                    <a href="sam.html">Sam Davies</a>
                </li>
            </ul>
        </nav>

        <!-- Header -->
        <header id="top" class="banner-top">
            <div class="" style="display: table-cell; display: table-cell;
                                 vertical-align: middle; padding-left: 80px;">
                <img class="portrait" src="img/ayrton.jpg" width=200 height=200 style="text-align: center" />
            </div>
            <div class="text-vertical-center">
                <h1>Ayrton Massey</h1>
                <h3>Web Application</h3>
            </div>
        </header>
        
        <div class="col-md-3" id="toc-container">
            <div style="padding-top:40px">
            </div>
            <div id="toc">
            </div>
        </div>

        <div class="col-md-9" id="report-context">
            <section class="col-md-12">
                
                <h1 class="page-header">Introduction</h1>

                <p>In this report I will discuss my contributions to
                the <em>SmartLock</em> project, discussing the motivation for
                design choices, technical implementation details and
                critical evaluation of the work produced.</p>

                <p>My contribution to the project can be summarised as
                    the following:</p>

                <ul>
                    <li>Produced a web application management
                        interface for administrating and operating
                        <em>SmartLock</em> devices</li>
                    <li>Developed a <em>SmartLock</em> device
                        communication emulator<sup><a
                        href="#gh-lock-emulator">[1]</a></sup> to
                        allow development of the software components
                        independently from the hardware</li>
                    <li>Improved the API logic<sup><a
                        href="#gh-lock-logic">[2]</a></sup> for
                        communicating with the <em>SmartLock</em>
                        device.</li>
                    <li>Contributed endpoints<sup><a
                        href="#gh-api-endpoints">[3]</a></sup> to the
                        API to provide data required by the web
                        application.</li>
                </ul>
                
                <subsection class="col-md-12">
                    
                    <h2>Motivation</h2>
                    
                    <p>The task for this course was to design and
                        build an Internet of Things (IoT) device and
                        a suite of applications to interface with it.</p>

                    <p>We met up in the first week of the semester to
                        share our ideas and take the most promising ones
                        to the next stage. Some of those ideas included:</p>

                    <ul>
                        <li>
                            A <strong>dance mat</strong> which
                            measures the level of movement, to allow
                            nightclub DJs to analyse the crowd's
                            reactions to the music being played and
                            use this information to improve their
                            playlist.
                        </li>
                        <li>
                            A <strong>board game</strong> which
                            detects game pieces and shares its state
                            with an API, allowing two players to play
                            against each other remotely (either via
                            another board, or an app we would
                            develop), or against an AI.
                        </li>
                        <li>
                            A <strong>door lock</strong> which can be
                            opened remotely via the internet, allowing
                            the owner to share access with friends or
                            housemates.
                        </li>
                    </ul>

                    <p>The group decided that the door lock idea had
                        the most potential. The project was small
                        enough in scope to allow us to focus on
                        producing a quality product, but large enough
                        to provide each team member with a substantial
                        amount of interesting work.</p>

                    <p>I had a very personal stake in this idea;
                        myself and my flatmate have thought about
                        implementing it before (after one too many
                        accidental lock-outs), but we have never had
                        the time to explore it until now.</p>
                    
                </subsection>
                
                <subsection class="col-md-12">
                    
                    <h2>Problem Analysis</h2>
                    
                    <p>To create the door lock we would need an
                    <strong>integrated system</strong> to handle
                    communication between the device and the user. We
                    also wanted to provide <strong>iOS</strong>,
                    <strong>Android</strong> and <strong>web</strong>
                    applications to allow users to access the lock
                    wherever they are, using whatever device they have
                    available.</p>

                    <p>I was tasked with development of the web
                    application, which was intended to be an
                    <strong>administrative interface</strong> where a
                    user could control their devices and who has
                    access to them. We later extended this
                    functionality to the mobile applications,
                    providing consistency across all devices.</p>

                    <p>We felt it was important that the application use
                    <strong>responsive design</strong> techniques to
                    provide access to users on operating systems other
                    than iOS and Android (such as Windows Phones and
                    Blackberry devices).</p>

                    <p>The application would need to provide the
                        following core functionality:</p>

                    <ul>
                        <li>Provide a means to <strong>register devices</strong> to a user</li>
                        <li>Allow users to <strong>operate</strong> their registered devices remotely</li>
                        <li>Display the <strong>status</strong> of their registered devices at all times</li>
                        <li>Provide <strong>shared access controls</strong></li>
                        <li>Allow <strong>secure communication</strong> between the user and their device</li>
                        <li>Display correctly across a <strong>range of mobile and desktop platforms</strong></li>
                    </ul>
                    
                </subsection>
                    
            </section>

            <section class="col-md-12">
                
                <h1 class="page-header">Design</h1>

                <p>In this section I will discuss the motivation for
                design decisions, as well as describe the overall
                architecture of the integrated system.</p>
                
                <subsection>

                    <h2>Communication</h2>
                
                    <p>After establishing the requirements for the
                    project we discussed the system architecture. We
                    considered a few methods of communication: one in
                    which the mobile device acts as the base station
                    for the lock, communicating with it via bluetooth
                    and passing communications over a 4G / WiFi
                    network to and from an API; another in which the
                    mobile device connected to and authenticated with
                    the lock directly.</p>

                    <p>However, we decided that these systems were too
                    insecure. In the first system the mobile device
                    could easily spoof communications from the API,
                    bypassing any authentication system in place. In
                    the second, the lock would not have a trusted
                    authority for authentication at all and would thus
                    have to trust the mobile device completely. In
                    both systems there would be no way for a user to
                    monitor the lock's status if there were no mobile
                    devices present nearby, violating the requirement
                    for users to be able to view the status of their
                    devices at all times.</p>

                    <p>We designed a third system in which the lock
                    communicates with an API directly over a WiFi or
                    mobile network. This system removed the security
                    issues present in the other two designs, as a
                    mobile device would need to authenticate with a
                    central API server and the lock would only
                    communicate with a trusted authority. Having the
                    lock repeatedly ping the server would provide
                    status updates to the API at regular intervals,
                    notifying users when their lock disappears from
                    the network (perhaps due to a power outage or
                    vandalism) and keeping information about the lock
                    up-to-date at all times.</p>

                    <p>Communicating this information to the user is
                    where I come in. Using a central API allows us to
                    develop a suite of applications to display
                    information collected by the API. All of the
                    authentication, user and device management is
                    handled by the API, providing a uniform experience
                    across all devices and removing the need for
                    separate implementations of the same logic. All I
                    would need to do is develop a means of
                    communication between my application and the API
                    alongside <a href="michael.html">Michael</a>.</p>

                    <subsection>
                        
                        <h3>API Communications</h3>

                        <p>The software developers on the team laid out
                            the following API specification which would
                            provide the minimum required functionality to each
                            app:</p>

                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>API Endpoint</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>/user</code></td>
                                    <td>
                                        <ul>
                                            <li>Provides information about all
                                                users on the system to enable friend
                                                search.</li>
                                            <li>Provides registration function
                                                for new users.</li>
                                        </ul>
                                    </td>
                                </tr>

                                <tr>
                                    <td><code>/friend</code></td>
                                    <td>
                                        <ul>
                                            <li>Provides information about
                                                a user's friends,
                                                including what access they
                                                have to each others'
                                                devices.</li>
                                            <li>Provides functionality for
                                                adding and removing friends.</li>
                                        </ul>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td><code>/lock[/&lt;id&gt;]</code></td>
                                    <td>
                                        <ul>
                                            <li>Provides information about a user's registered devices.</li>
                                            <li>Provides detailed information about a specific device.</li>
                                            <li>Provides functionality for registering new devices.</li>
                                        </ul> 
                                    </td>
                                </tr>

                                <tr>
                                    <td><code>/friend-lock</code></td>
                                    <td>
                                        <ul>
                                            <li>Allow users to give or revoke access to a device to a friend.</li>
                                        </ul> 
                                    </td>
                                </tr>

                                <tr>
                                    <td><code>/open/&lt;id&gt;</code></td>
                                    <td>
                                        <ul>
                                            <li>Send a request to open a lock.</li>
                                        </ul> 
                                    </td>
                                </tr>

                                <tr>
                                    <td><code>/close/&lt;id&gt;</code></td>
                                    <td>
                                        <ul>
                                            <li>Send a request to close a lock.</li>
                                        </ul> 
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <p>We would also need to settle upon a method for
                            securely communicating between the API and the
                            web application. We decided to use <strong>HTTP Basic
                            Authentication</strong> to begin development,
                            which is achieved by sending the base 64
                            encoded username and password in the HTTP
                            request header. Base 64 encoding is not a
                            secure method of communcation as the process
                            is easily reversed; we settled upon this
                            authentication method not because it was
                            secure but because it was simple to implement.
                            This allowed us to focus on adding functionality
                            to the applications. In a production
                            environment we would need to change the method
                            of authentication to something more secure.</p>
                        
                    </subsection>

                    <subsection>

                        <h3>Lock Communication</h3>

                        <p>Once the lock hardware was built we
                            discovered that our initial design for the
                            lock's communication was insufficient. The
                            lock was only able to send HTTP
                            <code>GET</code> requests to the API to
                            indicate its current status, so we needed
                            to re-think our communication design. The
                            original approach we used also prevented
                            the user from opening the lock with a
                            physical key: if the lock believed it
                            should be closed, it would continue to try
                            to close the lock even when a key was
                            used. Together with <a href="jp.html">JP</a>, <a
                            href="sam.html">Sam</a>, and Michael, I
                            re-designed the logic for the lock system
                            to use a follow-the-leader approach with
                            the lock being the leader. This design
                            caused the API to work in conjunction with
                            a physical key, making <em>requests</em>
                            for the lock to close but never forcing it
                            to do so.</p>

                        <table class="table table-striped">
                            
                            <thead>
                                
                                <tr>
                                    <th>Lock State</th>
                                    <th>API State</th>
                                    <th>Application Request</th>
                                    <th>Description</th>
                                </tr>
                                
                            </thead>
                            
                            <tbody>

                                <tr>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td>Initially, all systems agree that the lock is open.</td>
                                </tr>

                                <tr>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td>A user makes a request to close the lock.</td>
                                </tr>

                                <tr>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td>The API sends a request to the lock to close but the lock is still reporting that it is open.</td>
                                </tr>

                                <tr>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td>The lock receives the request to close the lock.</td>
                                </tr>

                                <tr>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td>The lock tells the API that the lock is closed.</td>
                                </tr>

                                <tr>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td>The web application receives the information that the lock is closed.</td>
                                </tr>
                                
                                <tr>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td>A user opens the lock with a physical key. The lock now reports that it is open.</td>
                                </tr>

                                <tr>
                                    <td style="color: #5cb85c; font-weight: bold">Open</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td>The API requests that the lock close again but the lock remains open.</td>
                                </tr>

                                <tr>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #f0ad4e; font-weight: bold">Pending Close</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td>The user locks the door with the physical key. The lock begins reporting that it is closed.</td>
                                </tr>

                                <tr>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td style="color: #d9534f; font-weight: bold">Closed</td>
                                    <td>The systems agree once more.</td>
                                </tr>

                            </tbody>

                        </table>
                        
                </subsection>
                
            </section>


            <section class="col-md-12">
                
                <h1 class="page-header">References</h1>
                
                <ol>
                    <li><a name="gh-lock-emulator"></a>
                        <a href="https://github.com/ayrtonmassey/SLIP-D/blob/master/fakelock.py">
                            Massey, A. (2015).
                            <em>SmartLock Emulator Script</em>.
                            Edinburgh, UK.
                        </a></li>
                    <li><a name="gh-lock-logic"></a>
                        <a href="https://github.com/mingles-/SLIP-D/commit/54069f208cef5fe4d8626ed465c650b4225fc8b8">
                            Massey, A. (2015).
                            <em>SmartLock API Logic</em>.
                            Edinburgh, UK.
                        </a></li>
                    <li><a name="gh-api-endpoints"></a>
                        <a href="https://github.com/mingles-/SLIP-D/commit/05f432d7ad2e27e135e1ae4c4c1ba7f9f1cb825e">
                            Massey, A. (2016).
                            <em>SmartLock API Endpoints</em>.
                            Edinburgh, UK.
                        </a></li>
                </ol>
                
            </section>
            
        </div>
        
        <!-- jQuery -->
        <script src="js/jquery.js"></script>
        <!-- <script src="jquery-1.7.2.min.js"></script> -->
        <script src="js/jquery-ui-1.9.1.custom.min.js"></script>
        <script src="js/jquery.tocify.min.js""></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script>
         // Closes the sidebar menu
         $("#menu-close").click(function(e) {
             e.preventDefault();
             $("#sidebar-wrapper").toggleClass("active");
         });

         // Opens the sidebar menu
         $("#menu-toggle").click(function(e) {
             e.preventDefault();
             $("#sidebar-wrapper").toggleClass("active");
         });

         //Executes your code when the DOM is ready.  Acts the same as $(document).ready().
         $(function() {
             //Calls the tocify method on your HTML div.
             $("#toc").tocify({context: '#report-context',
                               scrollTo: 0});
             $(function($) {
                 var $cache = $('#toc');
                 w = $cache.outerWidth();
                 ml = $cache.css('margin-left');
                 function fixDiv() {
                     if ($(window).scrollTop() > $("header").outerHeight()) {
                         $cache.css({
                             'position': 'fixed',
                             'top': '40px',
                             'width': w
                         });
                     } else {
                         $cache.css({
                             'position': 'static',
                             'width': w,
                             'margin-left': ml,
                         });
                     }
                 }
                 $(window).scroll(fixDiv);
                 fixDiv();
             });
         });

        </script>

    </body>

</html>
